---
title: "Advanced-functionalities"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Advanced-functionalities}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)


```

```{r setup}

library(joyn)
library(data.table)

x <- data.table(id = c(1, 4, 2, 3, NA),
                t  = c(1L, 2L, 1L, 2L, NA),
                country = c(16, 12, 3, NA, 15))
  
y <- data.table(id  = c(1, 2, 5, 6, 3),
                gdp = c(11L, 15L, 20L, 13L, 10L),
                country = 16:20)

```

## Advanced use

This vignette will let you explore some additional features available in `joyn`, through an example use case.

Suppose you want to join tables `x` and `y`, where the variable *country* is available in both. You could do one of five things:

### 1. Use variable *country* as one of the key variables

If you don't use the argument `by`, `joyn` will consider *country* and *id* as key variables by default given that they are common between `x` and `y`. 

```{r ex1}

# The variables with the same name, `id` and `country`, are used as key
# variables.

joyn(x = x, 
     y = y)

```

Alternatively, you can specify to join by *country*

```{r ex2}

# Joining by country

joyn(x = x, 
     y = y, 
     by = "country")

```

### 2. Ignore variable *country* from `y` and don't bring it into the resulting table
### NEED TO CHECK!

This the default if you did not include *country* as part of the key variables
in argument `by`. As a result, it will not be retained in the returning table.

```{r}

joyn(x = x, 
     y = y, 
     by = "id")

```

### 3. Update only NAs in table x

Update only NAs values in variable *country* in table x (i.e., left or master)
with the actual values of the matching observations in *country* from table y
(i.e, right or using). In this case, actual values in *country* from table x
will remain unchanged.

```{r}
joyn(x, y, by = "id", update_NAs = TRUE)[]
```

### 4. Update actual values in table x

Update all the values--NAs and actual--in variable *country* of table x (i.e.,
left or master) with the actual values of the matching observations in *country*
from table y (i.e, right or using). Also, notice the output of the table below:
only the values that are different between *country* from x and *country* from y
are updated. If, for the same matching observations, the values between the two
*country* variables are the same, the reporting variable says "x & y" rather
than "value updated", so you know that there is no update to make. Finally, If
there are NAs in variable *country* from **table y**, the actual values in x
will be **unchanged**, and you get a "not updated" status in the reporting
variable. Yet, there is a way to solve this, which explained below using
argument `keep_y_in_x`.

```{r}
# notice that only the value that are 
joyn(x, y, by = "id", update_values = TRUE)[]
```

### 5. Keep matching-names variables from y into x (No update)

Bring variable *country* from y into the resulting table with a different name
(*country.y*).

```{r}
joyn(x, y, by = "id", keep_common_vars = TRUE)[]
```

If you need to update *country* in x, including the actual values with NAs from
*country* in y, you could do the following, keeping in mind that the reporting
variable is not that useful anymore.

### Updating values in left table

### Keeping variables from right table

### Keeping common variables

### 

#### JOYn report

**Displaying messages**

### 
